(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{184:function(s,e,t){s.exports=t.p+"assets/img/7.0290dedd.png"},185:function(s,e,t){s.exports=t.p+"assets/img/8.dcee75f1.png"},186:function(s,e,t){s.exports=t.p+"assets/img/9.47398f56.png"},199:function(s,e,t){"use strict";t.r(e);var a=t(0),n=Object(a.a)({},function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"api的理解和使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api的理解和使用","aria-hidden":"true"}},[s._v("#")]),s._v(" API的理解和使用")]),s._v(" "),a("h2",{attrs:{id:"通用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 通用命令")]),s._v(" "),a("h3",{attrs:{id:"全局命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 全局命令")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("keys：遍历出redis中所有的key(keys *)")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('127.0.0.1:6380> set hello world\nOK\n127.0.0.1:6380> set java good\nOK\n127.0.0.1:6380> set python good\nOK\n127.0.0.1:6380> set php best\nOK\n127.0.0.1:6380> keys *\n1) "php"\n2) "python"\n3) "java"\n4) "hello"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("keys [pattern]：遍历所有key(匹配正则)")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('127.0.0.1:6380> keys he*\n1) "hello"\n127.0.0.1:6380> keys p\n(empty list or set)\n127.0.0.1:6380> keys *p\n1) "php"\n127.0.0.1:6380> keys ^p\n(empty list or set)\n127.0.0.1:6380> keys ^p* \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("keys命令一般不在生产环境中使用，生产环境中key太多，容易造成阻塞，生产环境中可以使用scan 命令")])])]),s._v(" "),a("li",[a("p",[s._v("dbsize：计算key的总数")]),s._v(" "),a("ul",[a("li",[s._v("dbsize命令在计算总数时不会遍历所有键，而是直接获取Redis内置的键总数变量，所以dbsize命令的时间复杂度是o(1)")])]),s._v(" "),a("ul",[a("li",[s._v("keys命令会遍历所有的键，所以它的时间复杂度是o(n)，当Redis中保存了大量的键时，禁止在生产环境上使用keys命令")]),s._v(" "),a("li",[a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6380> dbsize\n(integer) 4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("exists key：判断key是否存在，如果存在返回1，否则返回0，时间复杂度为o(1)")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6380> exists hello\n(integer) 1\n127.0.0.1:6380> exists hello1\n(integer) 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("del key [key...]：删除指定的key，可以同时删除多个key，返回结果为删除成功的个数，如果键不存在，则返回0")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6380> del hello\n(integer) 1\n127.0.0.1:6380> del java python\n(integer) 2\n127.0.0.1:6380> del hello1\n(integer) 0\n127.0.0.1:6380> del php hello1\n(integer) 1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("expire key seconds：设置key在多少秒以后过期，当超过过期时间后，键会自动删除，此命令可以设置过期的毫秒数")])]),s._v(" "),a("li",[a("p",[s._v("ttl key：查看key剩余的过期时间，有三种返回值")]),s._v(" "),a("ul",[a("li",[s._v("大于或等于0的整数：key的过期时间，等于0表示此瞬间后会被删除")]),s._v(" "),a("li",[s._v("-1：键没有设置过期时间，会一直存在")]),s._v(" "),a("li",[s._v("-2：键不存在")])])]),s._v(" "),a("li",[a("p",[s._v("persist key：去掉键的过期时间，使键会一直存在")])]),s._v(" "),a("li",[a("p",[s._v("type key：返回key的类型")]),s._v(" "),a("ul",[a("li",[s._v("type主要有以下类型：string、hash、list、set、zset、none(如果键不存在返回none)")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1:6380> set hello world\nOK\n127.0.0.1:6380> type hell\nnone\n127.0.0.1:6380> type hello\nstring\n127.0.0.1:6380> sadd myset 1 2 3\n(integer) 3\n127.0.0.1:6380> type myset\nset\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("各命令的时间复杂度：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("命令")]),s._v(" "),a("th",[s._v("时间复杂度")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("keys")]),s._v(" "),a("td",[s._v("o(n)")])]),s._v(" "),a("tr",[a("td",[s._v("dbsize")]),s._v(" "),a("td",[s._v("o(1)")])]),s._v(" "),a("tr",[a("td",[s._v("del")]),s._v(" "),a("td",[s._v("o(1)")])]),s._v(" "),a("tr",[a("td",[s._v("exists")]),s._v(" "),a("td",[s._v("o(1)")])]),s._v(" "),a("tr",[a("td",[s._v("expire")]),s._v(" "),a("td",[s._v("o(1)")])]),s._v(" "),a("tr",[a("td",[s._v("type")]),s._v(" "),a("td",[s._v("o(1)")])])])])])]),s._v(" "),a("h3",{attrs:{id:"数据结构与内部编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构与内部编码","aria-hidden":"true"}},[s._v("#")]),s._v(" 数据结构与内部编码")]),s._v(" "),a("ol",[a("li",[s._v("type命令实际上返回的是当前键的数据结构类型：string、hash、list、set、zset；但这些只是Redis对外的数据结构，但Redis内部每种数据结构都有自己的内部编码实现，而且是多种实现，会在合适的场景下选择合适的内部编码")]),s._v(" "),a("li",[s._v("各类型的多种内部编码实现："),a("img",{attrs:{src:t(184),alt:"内部编码实现"}})]),s._v(" "),a("li",[s._v("redis对象\n"),a("ul",[a("li",[a("p",[s._v("redis的键值都是redisObject对象，即在创建时会生成一个用于键名的redisObject对象和一个用于键值的redisObject对象")])]),s._v(" "),a("li",[a("p",[s._v("那么redis是如何关联键值对？这都是依赖于键空间，其结构是字典(key-value)用于绑定redisObject键值对")])]),s._v(" "),a("li",[a("p",[s._v("redisObject，其结构体如下：")]),s._v(" "),a("div",{staticClass:"language-C line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("redisObject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 编码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指向数据的指针")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ptr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 记录对象最后一次被程序访问时间，用于计算空转时长(当前时间-lru)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" lru"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* lru time (relative to server.lruclock) */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 引用计数，用于内存回收")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" refcount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" robj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("其中字段描述：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("字段")]),s._v(" "),a("th",[s._v("描述")]),s._v(" "),a("th",[s._v("值")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("type")]),s._v(" "),a("td",[s._v("记录了对象的类型名称")]),s._v(" "),a("td",[s._v("string，list，hash，set，zset")])]),s._v(" "),a("tr",[a("td",[s._v("encoding")]),s._v(" "),a("td",[s._v("记录了对象所使用的编码名称")]),s._v(" "),a("td",[s._v("int，embstr，raw，hashtable， ziplist，intset，linkedlist，skiplist")])]),s._v(" "),a("tr",[a("td",[s._v("lru")]),s._v(" "),a("td",[s._v("记录对象最后一次被程序访问的时间")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("refcount")]),s._v(" "),a("td",[s._v("引用计数")]),s._v(" "),a("td",[s._v("初始值为1")])])])])]),s._v(" "),a("li",[a("p",[s._v("redisObject"),a("img",{attrs:{src:t(185),alt:"redisObject结构图"}})])])])]),s._v(" "),a("li",[s._v("类型与编码格式\n"),a("ul",[a("li",[s._v("REDIS_OBJECT中的ptr指向各类型的值，并且针对不同类型会有不同的编码格式，甚至同一类型根据值的不同也有不同的编码格式；")]),s._v(" "),a("li",[s._v("redis会根据值的长度以及个数的不同选择其对应的编码格式，都是为了更好的优化对象在不同场景下的使用效率")]),s._v(" "),a("li",[s._v("以下便是所有的对象所对应的编码格式以及场景："),a("img",{attrs:{src:t(186),alt:"编码格式"}})])])])]),s._v(" "),a("h3",{attrs:{id:"单线程架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单线程架构","aria-hidden":"true"}},[s._v("#")]),s._v(" 单线程架构")]),s._v(" "),a("ol",[a("li",[s._v("Redis使用了单线程架构和I/O多路复用模型来实现高性能的内存数据库服务")]),s._v(" "),a("li",[s._v("Redis中的一条命令从客户端达到服务端不会立刻会执行，所有命令都会进入一个队列中，然后逐个被执行，但保证不会存在两条命令同时被执行，所以不会产生并发问题")]),s._v(" "),a("li",[s._v("为什么单线程还能这么快?\n"),a("ul",[a("li",[s._v("纯内存访问")]),s._v(" "),a("li",[s._v("非阻塞IO，Redis使用epoll作为I/O多路复用技术的实现，再加上Redis自身的事件处理模型将epoll中的连接、读写、关闭都转换为事件，不在网络I/O上浪费过多的时间")]),s._v(" "),a("li",[s._v("由于是单线程，避免了线程之间的切换和竞态产生的消耗")])])]),s._v(" "),a("li",[s._v("注意：如果Redis中某个命令执行时间过长，会造成其他命令的阻塞，对于Redis这种高性能的服务来说很致命。所以在Redis中拒绝长命令，比如keys、flushall、flushdb、slow lua script、mutil/exec、operate big value等")])]),s._v(" "),a("h2",{attrs:{id:"五种主要的数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五种主要的数据结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 五种主要的数据结构")]),s._v(" "),a("h3",{attrs:{id:"字符串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串","aria-hidden":"true"}},[s._v("#")]),s._v(" 字符串")]),s._v(" "),a("h3",{attrs:{id:"哈希"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#哈希","aria-hidden":"true"}},[s._v("#")]),s._v(" 哈希")]),s._v(" "),a("h3",{attrs:{id:"列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列表","aria-hidden":"true"}},[s._v("#")]),s._v(" 列表")]),s._v(" "),a("h3",{attrs:{id:"集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合","aria-hidden":"true"}},[s._v("#")]),s._v(" 集合")]),s._v(" "),a("h3",{attrs:{id:"有序集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有序集合","aria-hidden":"true"}},[s._v("#")]),s._v(" 有序集合")])])},[],!1,null,null,null);e.default=n.exports}}]);